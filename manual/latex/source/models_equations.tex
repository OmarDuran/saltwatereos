\section{Models and Equations}
Earch solver in \foam can solve different problems, corresponding to different models.

\begin{itemize}
	\item \darcyfoam : single phase hydrothermal convection in porous media based on Darcy's law, the fluid is represented by pure water and thus the equation of state (EOS) is based on IAPWS-97\footnote{EOS of pure water is implemented based on \href{http://freesteam.sourceforge.net}{freesteam2.0}} \citep{wagner2007international}. 
	\darcyfoam can be used to explore convection dynamics and circulation patterns of hydrothermal in porous media.
	
	\item \anhydritefoam : this solver is a extension of \darcyfoam, anhydrite precipitation and dissolution reaction is implemented based on solubility product \citep[~e.g.][]{kawada2010formation},
	in addition anhydrite precipitation will affect permeability structure. 
	Using this solver to explore chemical transport, minerial reaction and its dynamic effect on hydrothermal convection pattern.
\end{itemize}

\subsection{Single phase convection model}

\subsubsection{Basic equations}

Single phase hydrothermal convection model is described by a set of partial difference equations including mass conservation (Eq. \ref{eq:mass}), energy conservation (Eq. \ref{eq:temperature}) and Darcy's law (Eq. \ref{eq:darcy}).
The the symbols, their physical meaning and unit, and variable names are listed in table \ref{tab:symbols}.

\begin{equation}
\vec{U} = -\frac{k}{\mu_f} \left(  \nabla p -\rho_f \vec{g}  \right)
\label{eq:darcy}
\end{equation}

\begin{equation}
	\phi \frac{\partial \rho_f}{\partial t} = -\nabla \cdot (\rho_f \vec{U})
	\label{eq:mass}
\end{equation}

\begin{equation}
	\left[ {\phi {\rho _f}{c_{pf}} + \left( {1 - \phi } \right){\rho _r}{c_{pr}}} \right]\frac{{\partial T}}{{\partial t}} = \nabla  \cdot \left( {{k_r}\nabla T} \right) - {\rho _f}{c_{pf}} \vec{U} \cdot \nabla T + \frac{{{\mu _f}}}{k}{||\vec{U}||^2} - {\left( {\frac{{\partial \;ln\rho_f }}{{\partial \;lnT}}} \right)_p}\frac{{Dp}}{{Dt}} +Q
	\label{eq:temperature}
\end{equation}

\input{source/table_symbols.tex}  %add landscape layout table of symbols

Substituting equation \ref{eq:darcy} into equation \ref{eq:mass} to construct pressure equation \cite[e.g.][Eq. 5]{hasenclever2014hybrid},

\begin{equation}
	\phi \rho_f \left(  \beta_f \frac{\partial p}{\partial t} - \alpha_f \frac{\partial T}{\partial t} \right) = \nabla \cdot \left( \rho_f \frac{k}{\mu_f} \left( \nabla p - \rho_f \vec{g} \right) \right)
	\label{eq:pressure}
\end{equation}

We solve equation \ref{eq:pressure}, \ref{eq:temperature} to get pressure and temperature field. 
We use pure water as the fluid, and the thermal properties of water are calculated based on freesteam when paressure and temperature are given at a element.

\subsubsection{Boundary conditions}

To solve equation of pressure $p$ (Eq. \ref{eq:pressure}) and temperature $T$ (Eq. \ref{eq:temperature}) using finite volume method (FVM),
boundary conditions of $p$ and $T$ must be specified on every boundary of the mesh.
The boundary conditions can either be of Dirichlet (e.g. \mintinline{bash}{fixedValue}), Neumann (e.g. \mintinline{bash}{fixedGradient, zeroGradient}), or mixed boundary conditions (e.g. \mintinline{bash}{inletOutlet}).
OpenFOAM has a series of precompiled boundary conditions, including basic boundary conditions (\mintinline{bash}{fixedValue, fixedGradient, zeroGradient, mixed}), 
generic boundary conditions (e.g. \mintinline{bash}{codedFixedValue, codedFixedGradient}),
and derived boundary conditions for sepcific solvers, see \href{https://www.openfoam.com/documentation/user-guide/standard-boundaryconditions.php}{standard boundary conditions of OpenFOAM} for more details. 

\textbf{Note} that not all the OpenFOAM precompiled boundary conditions are valid for \foam , most of the boundary conditions are only valid for specific solvers. 
The valid boundary conditions for \foam are listed below,

\begin{enumerate}
	\item \mintinline{bash}{fixedValue}
	\item \mintinline{bash}{fixedGradient}
	\item \mintinline{bash}{zeroGradient}
	\item \mintinline{bash}{inletOutlet}
	\item \mintinline{bash}{codedFixedValue}
	\item \mintinline{bash}{codedFixedGradient}
\end{enumerate}
see \nameref{sec:cookbooks} section for more details of usage of each boundary conditions.

\foam has several customized boundary conditions for $T$ or $p$,
\begin{enumerate}
	\item \mintinline{bash}{HydrothermalHeatFlux} \\
	\mintinline{bash}{HydrothermalHeatFlux} is a kind of Neumann boundary condition for $T$, heat flux $\vec{\phi_q}=-k_r \nabla T$. For hydrothermal system, the commonly used heat flux boundary condition is on the bottom representing heat source, whih means that the heat flux always flow into the calculation domain and thus $\phi_q = -k_r \nabla T\cdot \vec{n}$ is always negative, and hense gradient of temperature $\nabla T \cdot \vec{n} =- \phi_q /k_r$ is positive. We define $q=-\phi_q$ and an example of usage as below,
	
	\begin{minted}[bgcolor=\bgcolor_Code,tabsize=2]{c++}
		bottom
		{
			type              HydrothermalHeatFlux;
			q                 uniform 0.05; //W/m^2
			value             uniform 0;
		}
	\end{minted}
	where the entity of \mintinline{bash}{value } is just a place holder for OpenFOAM.
	
	\item \mintinline{bash}{HydrothermalMassFluxPressure} \\
	\mintinline{bash}{HydrothermalMassFluxPressure} ia a Neumann boundary conditon for pressure $p$, 
	from Darcy's law (eq. \ref{eq:darcy}) we can get mass flux $\phi_m$ expressed by  gradient of pressure
	$\phi_m = \rho_f \vec{U} \cdot \vec{n} = - \frac{\rho_f k}{\mu_f} (\nabla p-\rho_f \vec{g}) \cdot \vec{n}$, 
	then the gradient of pressure can be expressed as
	 $\nabla p \cdot \vec{n}=-\frac{\mu_f}{\rho_f k} \phi_m +\rho_f \vec{g} \cdot \vec{n}$.
	 If specified mass flux flows into calculation domain, $\phi_m$ is negative, otherwise is positive.
	 We define $q=\phi_m$ and an example of usage as below,
	 
	  \begin{minted}[bgcolor=\bgcolor_Code,tabsize=2]{c++}
	  bottom
	  {
		  type              HydrothermalMassFluxPressure;
		  q                 uniform -0.0115; //kg/s
		  value             uniform 0;
	  }
	  \end{minted}
	
	\item \mintinline{bash}{noFlux} \\
	\mintinline{bash}{noFlux} is a special case of \mintinline{bash}{HydrothermalMassFluxPressure} when $\phi_m =0$, and it is pressure boundary condition on impermeable side walls, for example,
	
	\begin{minted}[bgcolor=\bgcolor_Code,tabsize=2]{c++}
	left
	{
		type              noFlux;
		value             uniform 0;
	}
	right
	{
		type              noFlux;
		value             uniform 0;
	}
	\end{minted}
	
	\item \mintinline{bash}{submarinePressure} \\
	\mintinline{bash}{submarinePressure} is a Dirichlet boundary condition for pressure $p$, which is usually used on seafloor boundary. The fixed pressure on seafloor boundary is calculated by seawater hydrostatic pressure $p_{seafloor} = \rho_0 g z$ with $\rho_0$ seawater density (default value is 1013 $kg/m^3$),  $g$ gravitational acceleration (default value is -9.81 $m/s^2$), and $z$ is netative and represents bathymetry. An example of usage is listed below,
	
	\begin{minted}[bgcolor=\bgcolor_Code,tabsize=2]{c++}
	top
	{
		type            submarinePressure;;
		rhoValue        uniform 1013; //optional
	}
	\end{minted}
\end{enumerate}

\begin{theo}[Boundary conditions]{note:boundaryConditions}
	The library of "\textcolor{blue}{libHydrothermalBoundaryConditons}.dylib" must be added in \mintinline{bash}{system/controlDict} before using the above boundary conditions. For examlpe,
	\begin{minted}[tabsize=2]{c++}
		libs 
		( 
			"/usr/local/lib/libfreesteam.dylib" 
			"libHydrothermalBoundaryConditons.dylib"
		);
	\end{minted}
	The extension name of library file should be \textcolor{blue}{dylib} and \textcolor{blue}{lib} on Mac OS and Linux, respectively.
\end{theo}

\subsection{Single phase anhydrite reaction model}

\subsubsection{Govening equations of chemical species transport}
The diffusion and advection process of chemical species are governed by equation \ref{eq:chemical_transport},

\begin{equation}
	\phi \frac{{\partial {\rho _i}{C_i}}}{{\partial t}} = \nabla  \cdot \left( {{D_c}\nabla {C_i}} \right) - \nabla  \cdot ({C_i}{\rho _f}\vec v) + {Q_i},\;i = {\rm{C}}{{\rm{a}}^{2 + }},\;{\rm{SO}}_4^{2 - }
	\label{eq:chemical_transport}
\end{equation}
the symbols and their physical meaning are lised in table \ref{tab:symbols}. 

\subsubsection{Boundary conditions of chemical species}
In order to solve equation \ref{eq:chemical_transport}, 
boundary conditions of $C_i (i=\text{Ca}^{2+}, \text{SO}_4^{2-})$ must be specified.
The commonly used boundary conditions for $C_i$ are \mintinline{bash}{fixedValue, inletOutlet} and \mintinline{bash}{zeroGradient}, 
while \mintinline{bash}{fixedGradient} is also valid for $C_i$. 
For example, just like temperature $T$, \cca boundary conditions on the seafloor representing concentration of \ca in seawater can be set as \mintinline{bash}{inletOutlet} (mixed). 
If fluid flow out, the boudnary condition is zero gradient, 
in contrast, if fluid flow in, the boundary condition is fixedValue. An example of useage is listed below,

\begin{minted}[bgcolor=\bgcolor_Code,tabsize=2]{c++}
top
{
	type            inletOutlet;
	inletValue      uniform 4e-4;	//seawater
}
bottom
{
	type            fixedValue;
	value           uniform 4e-3;	//hydrothermal fluid
}
left
{
	type            zeroGradient;
}
\end{minted}

\subsubsection{Anhydrite reaction and permeability feedback}
Anhydrite precipitation or dissolution is determined by solubility product $K_{sp}$ \citep{kawada2010formation}, which is a temperature dependent properties.
see \textcolor{red}{JRG paper for more details}

